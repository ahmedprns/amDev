var materialKanban=function(){"use strict";var e={version:"1.0.2b",escapeHTML:function(e){if(null===e)return null;if(void 0!==e){if("object"==typeof e)try{e=JSON.stringify(e)}catch(e){}try{return apex.util.escapeHTML(String(e))}catch(a){return(e=String(e)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}}},loader:{start:function(e){try{apex.util.showSpinner($(e))}catch(t){var a=$("<span></span>");a.attr("id","loader"+e),a.addClass("ct-loader fa-stack fa-3x");var r=$("<i></i>");r.addClass("fa fa-circle fa-stack-2x"),r.css("color","rgba(121,121,121,0.6)");var n=$("<i></i>");n.addClass("fa fa-refresh fa-spin fa-inverse fa-stack-1x"),n.css("animation-duration","1.8s"),a.append(r),a.append(n),$(e).append(a)}},stop:function(e){$(e+" > .u-Processing").remove(),$(e+" > .ct-loader").remove()}},jsonSaveExtend:function(e,a,r){void 0==r&&(r=!0);var n={};if("string"==typeof a)try{a=JSON.parse(a)}catch(e){console.error("Error while try to parse udConfigJSON. Please check your Config JSON. Standard Config will be used."),console.error(e),console.error(a)}else n=a;try{n=$.extend(r,[],e,a)}catch(a){console.error("Error while try to merge udConfigJSON into Standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),console.error(a),n=e,console.error(n)}return n},noDataMessage:{show:function(e,a){var r=$("<div></div>").css("margin","12px").css("text-align","center").css("padding","64px 0").addClass("nodatafoundmessage"),n=$("<div></div>"),t=$("<span></span>").addClass("fa").addClass("fa-search").addClass("fa-2x").css("height","32px").css("width","32px").css("color","#D0D0D0").css("margin-bottom","16px");n.append(t);var o=$("<span></span>").text(a).css("display","block").css("color","#707070").css("font-size","12px");r.append(n).append(o),$(e).append(r)},hide:function(e){$(e).children(".nodatafoundmessage").remove()}},groupBy:function(e,a){var r=new Map;return e.forEach(function(e){var n=a(e);r.has(n)?r.get(n).push(e):r.set(n,[e])}),r}};return{initialize:function(a,r,n,t,o,d,s,i,l){function c(){if(r)e.loader.start(E),apex.server.plugin(r,{pageItems:o,x01:"getData"},{success:function(e){b.trigger("materialkanbandataloaded"),p(e),b.trigger("materialkanbandatarendered")},error:function(e){E.empty(),console.log(e.responseText)},dataType:"json"});else try{e.loader.start(E),setTimeout(function(){p(dataJSON)},500)}catch(e){console.log("need data json"),console.log(e)}}function p(a){if(f.printDataToConsole&&(console.log(JSON.stringify(a)),console.log(a)),I=a.row,E.empty(),f.dynamicColumns){var t=[];e.groupBy(a.row,function(e){return e.COLUMN_ID}).forEach(function(e,a,r){a&&t.push(e[0])}),v=t}if($.each(v,function(a,r){!1!==s&&(r.COLUMN_ID=e.escapeHTML(r.COLUMN_ID),r.COLUMN_TITLE=e.escapeHTML(r.COLUMN_TITLE),r.COLUMN_ICON=e.escapeHTML(r.COLUMN_ICON),r.COLUMN_ICON_COLOR=e.escapeHTML(r.COLUMN_ICON_COLOR),r.COLUMN_HEADER_STYLE=e.escapeHTML(r.COLUMN_HEADER_STYLE),r.COLUMN_COLOR=e.escapeHTML(r.COLUMN_COLOR)),void 0==r.COLUMN_COLOR&&(r.COLUMN_COLOR="hsl("+46*a%350+", 55%, 60%)"),r.COLUMN_INDEX=r.COLUMN_INDEX?r.COLUMN_INDEX:a}),v&&v.length>0){T=f.groupExtension?100/(12*v.length/f.groupColWidth+1):0,h=(100-T)/v.length,T=Math.floor(100*T)/100,h=Math.floor(100*h)/100,function(e){var a=O(e);if(a.addClass("kb-row"),f.groupExtension){var r=$("<div></div>");r.addClass("kb-col kb-col-header"),r.attr("style","width:"+T+"%"),a.append(r)}$.each(v,function(e,n){(r=$("<div></div>")).addClass("kb-col kb-col-header"),r.attr("style","width:"+h+"%"),r.attr("id",n.COLUMN_ID);var t=$("<div></div>");t.addClass("kb-col-header-content");var o="border-top-color: "+n.COLUMN_COLOR+";";t.attr("style",n.COLUMN_HEADER_STYLE||o);var d=void 0!=n.COLUMN_TITLE?n.COLUMN_TITLE:"";t.append('<p class="title">'+d+"</p>"),r.append(t),a.append(r)})}(E);var d=O(E);if(d.addClass("kb-group-container"),a.row&&a.row.length>0){e.groupBy(a.row,function(e){return f.groupExtension?e.GROUP_ID:1}).forEach(function(a,r,n){if(r){var t=O(d);t.addClass("kb-row"),t.attr("groupid",r),f.groupExtension&&function(a,r){!1!==s&&(r.GROUP_ID=e.escapeHTML(r.GROUP_ID),r.GROUP_ICON=e.escapeHTML(r.GROUP_ICON),r.GROUP_ICON_COLOR=e.escapeHTML(r.GROUP_ICON_COLOR),r.GROUP_HEADER_STYLE=e.escapeHTML(r.GROUP_HEADER_STYLE),r.GROUP_TITLE=e.escapeHTML(r.GROUP_TITLE),r.GROUP_FOOTER=e.escapeHTML(r.GROUP_FOOTER));var n=$("<div></div>");n.addClass("kb-col kb-group-region"),n.attr("style","width:"+T+"%"),a.append(n);var t=u(n,{isGroupCard:!0,ID:r.GROUP_ID,ICON:r.GROUP_ICON,ICON_COLOR:r.GROUP_ICON_COLOR,HEADER_STYLE:r.GROUP_HEADER_STYLE,TITLE:r.GROUP_TITLE,FOOTER:r.GROUP_FOOTER,LINK:r.GROUP_LINK});if(t.addClass("kb-group-card"),f.groupCollapsible){var o=$("<i></i>");o.addClass("fa fa-chevron-down");var d=$("<div></div>");d.addClass("kb-collapsable kb-collapse"),d.append(o),$(t.find(".card-header")[0]).before(d);var i=$("<i></i>");i.addClass("fa fa-chevron-up");var l=$("<div></div>");l.addClass("kb-collapsable kb-expand"),l.append(i),$(t.find(".card-header")[0]).before(l),l.attr("style","display:none")}}(t,a[0]),$.each(v,function(r,n){!function(a,r,n){var t=$("<div></div>");t.addClass("kb-col kb-item-region"),t.attr("style","width:"+h+"%"),a.append(t);var o=$("<div></div>");o.addClass("kb-col-content");var d="border-left-color: "+n.COLUMN_COLOR+";";o.attr("style",n.COLUMN_HEADER_STYLE||d),t.append(o);var i=$("<div></div>");i.addClass("kb-col-inner-header");var l=void 0!=n.COLUMN_TITLE?n.COLUMN_TITLE:"";i.append('<p class="title">'+l+"</p>"),o.append(i);var c=$("<div></div>");if(c.addClass("kb-item-container"),c.attr("columnid",n.COLUMN_ID),o.append(c),0==n.COLUMN_INDEX){var p=r.filter(function(e){return e.GROUP_NEW_ITEM_LINK});p.length>0&&(c.addClass("kb-item-container-with-new-card"),C(o,p[0].GROUP_NEW_ITEM_LINK))}!function(a,r,n){a&&a.length>0&&$.each(a,function(a,t){!1!==s&&(t.ID=e.escapeHTML(t.ID),t.ICON=e.escapeHTML(t.ICON),t.ICON_COLOR=e.escapeHTML(t.ICON_COLOR),t.HEADER_STYLE=e.escapeHTML(t.HEADER_STYLE),t.TITLE=e.escapeHTML(t.TITLE),t.FOOTER=e.escapeHTML(t.FOOTER)),u(r,{isGroupCard:!1,ID:t.ID,ICON:t.ICON,ICON_COLOR:t.ICON_COLOR,HEADER_STYLE:t.HEADER_STYLE,TITLE:t.TITLE,FOOTER:t.FOOTER,LINK:t.LINK},n)})}(r.filter(function(e){return e.COLUMN_ID==n.COLUMN_ID&&e.ID}),c,n)}(t,a,n)}),f.groupExtension&&f.groupCollapsible&&(t.find(".kb-collapsable").click(function(){L(t,!0)}),1===a[0].GROUP_COLLAPESED&&L(t,!1))}});var c=a.row.filter(function(e){return e.NEW_GROUP_LINK});f.groupExtension&&c.length>0&&function(e,a){var r=O(e);r.addClass("kb-row");var e=r,n=$("<div></div>");n.addClass("kb-group-region kb-new-group-region"),e.append(n),C(n,a)}(E,c[0].NEW_GROUP_LINK),i&&(function(){var e=0,a=null;N=dragula($(b.find(".kb-item-container")).toArray(),{direction:"vertical",accepts:function(e,a,r,n){return!!f.allowDragItemsBetweenGroups||$(r).closest(".kb-row").attr("groupid")==$(a).closest(".kb-row").attr("groupid")}}),$(".kb-item-container > .kb-card").each(function(e,a){$(a).addClass("kb-card-draggable"),a.addEventListener("touchmove",function(e){e.preventDefault()})}),N.on("drag",function(r,n){var t=$(r),o=$(n);e=t.index();var d=t.next();a=d.length>0?$(d[0]):null;var s={itemId:t.attr("itemid"),sourceGroupId:o.closest(".kb-row").attr("groupid"),sourceColumnId:o.attr("columnid"),sourceItemIndex:e};b.trigger("materialkanbandrag",[s])}),N.on("drop",function(n,t,d,s){var i=$(n),l=$(t),c=$(d),p={itemId:i.attr("itemid"),sourceGroupId:c.closest(".kb-row").attr("groupid"),sourceColumnId:c.attr("columnid"),sourceItemIndex:e,targetGroupId:l.closest(".kb-row").attr("groupid"),targetColumnId:l.attr("columnid"),targetItemIndex:i.index()};try{apex.server.plugin(r,{pageItems:o,x01:"moveItem",x02:p.itemId,x03:p.sourceGroupId,x04:p.sourceColumnId,x05:p.sourceItemIndex,x06:p.targetGroupId,x07:p.targetColumnId,x08:p.targetItemIndex},{success:function(e){},error:function(e){a?i.insertBefore(a):c.append(i),g(i,c.attr("columnid")),console.error(e.responseText),b.trigger("materialkanbandroperror",[p])},dataType:"json"})}catch(e){console.log("Can't call server on drag'n drop event. Apex is missing"),console.log(e)}g(i,l.attr("columnid")),b.trigger("materialkanbandrop",[p])})}(),f.groupExtension&&l&&function(){var e=0,a=null;_=dragula($(b.find(".kb-group-container")).toArray(),{direction:"vertical",moves:function(e,a,r){var n=$(r).closest(".kb-group-card");return n.length>0}}),$(".kb-group-region > .kb-card").each(function(e,a){$(a).addClass("kb-card-draggable"),a.addEventListener("touchmove",function(e){e.preventDefault()})}),_.on("drag",function(r,n){var t=$(r);e=t.index();var o=t.next();a=o.length>0?$(o[0]):null;var d={groupId:t.attr("groupid"),sourceGroupIndex:e};b.trigger("materialkanbandraggroup",[d])}),_.on("drop",function(n,t,d,s){var i=$(n),l=($(t),$(d)),c={groupId:i.attr("groupid"),sourceGroupIndex:e,targetGroupIndex:i.index()};try{apex.server.plugin(r,{pageItems:o,x01:"moveGroup",x02:c.groupId,x03:c.sourceGroupIndex,x04:c.targetGroupIndex},{success:function(e){},error:function(e){a?i.insertBefore(a):l.append(i),console.error(e.responseText),b.trigger("materialkanbandroperror",[c])},dataType:"json"})}catch(e){console.log("Can't call server on drag'n drop event. Apex is missing"),console.log(e)}b.trigger("materialkanbandropgroup",[c])})}())}else d.css("min-height",""),e.noDataMessage.show(d,n)}else console.log("No columns defined!")}function O(e){var a=$("<div></div>");return a.addClass("s-g-row"),e.append(a),a}function u(e,a,r){var n=$("<div></div>");n.addClass("kb-card"),n.attr("itemid",a.ID);var t=$("<div></div>");if(t.addClass("card-header"),a.ICON||r&&r.COLUMN_ICON){var o=$("<i></i>");o.addClass("fa "+(a.ICON||r.COLUMN_ICON)),(a.ICON_COLOR&&a.ICON_COLOR.length>0||r&&r.COLUMN_ICON_COLOR&&r.COLUMN_ICON_COLOR.length>0)&&o.attr("style","color:"+(a.ICON_COLOR||r.COLUMN_ICON_COLOR)),t.append(o)}a.HEADER_STYLE?t.attr("style",a.HEADER_STYLE):r&&r.COLUMN_COLOR&&t.attr("style","background:"+r.COLUMN_COLOR),n.append(t);var d=$("<div></div>");d.addClass("card-content");var s=a.TITLE?a.TITLE:"";if(d.append('<p class="title">'+s+"</p>"),a.LINK){var i=$("<a></a>");i.attr("href",a.LINK),i.append(d),n.append(i)}else n.append(d);if(a.FOOTER){var l=$("<div></div>");l.addClass("card-footer");var c=$("<div></div>");c.append(a.FOOTER),l.append(c),n.append(l)}return e.append(n),n}function C(e,a){var r=$("<div></div>");r.addClass("kb-new-card");var n=$("<i></i>");n.addClass("fa fa-plus"),r.append(n);var t=$("<a></a>");t.attr("href",a),t.append(r);var o=$("<div></div>");o.addClass("kb-new-item-region"),o.append(t),e.append(o)}function g(e,a){var r=e.attr("itemid"),n=I.find(function(e){return e.ID==r}),t=v.find(function(e){return e.COLUMN_ID==a}),o=e.find(".card-header"),d=o.find("i");(n&&n.ICON||t&&t.COLUMN_ICON)&&(d.removeClass().addClass("fa "+(n.ICON||t.COLUMN_ICON)),(n.ICON_COLOR&&n.ICON_COLOR.length>0||t&&t.COLUMN_ICON_COLOR&&t.COLUMN_ICON_COLOR.length>0)&&d.attr("style","color:"+(n.ICON_COLOR||t.COLUMN_ICON_COLOR))),!n.HEADER_STYLE&&t&&t.COLUMN_COLOR&&o.attr("style","background:"+t.COLUMN_COLOR)}function L(e,a){e.find(".kb-collapsable").toggle(),e.find(".card-footer").toggle(),e.find(".kb-item-region").toggle();var r=e.find(".kb-group-region");if(r.toggleClass("kb-collapsed"),a){var n={groupId:e.attr("groupid"),collapsed:r.hasClass("kb-collapsed")};b.trigger("materialkanbangroupcollapsed",[n])}}var f={},v=(f=e.jsonSaveExtend({refresh:0,staticColumns:[{COLUMN_ID:"1",COLUMN_TITLE:"To Do",COLUMN_ICON:"fa-calendar"},{COLUMN_ID:"2",COLUMN_TITLE:"In Progress",COLUMN_ICON:"fa-wrench"},{COLUMN_ID:"3",COLUMN_TITLE:"Done",COLUMN_ICON:"fa-check"}],dynamicColumns:!1,groupExtension:!1,groupColWidth:6,allowDragItemsBetweenGroups:!1,groupCollapsible:!1,printDataToConsole:!1},t,!1)).staticColumns,I=null,N=null,_=null,E=null,T=0,h=100,b=$("#"+a);if(b.length>0){E=function(e){var a=$("<div></div>");return a.addClass("s-g-container"),a.css("min-height","170px"),e.append(a),a}(b),c();try{apex.jQuery("#"+d).bind("apexrefresh",function(){0==E.children("span").length&&(N&&N.destroy(),_&&_.destroy(),c())})}catch(e){console.log("Can't bind refresh event on "+d+". Apex is missing"),console.log(e)}f.refresh>0&&setInterval(function(){0==E.children("span").length&&(N&&N.destroy(),_&&_.destroy(),c())},1e3*f.refresh)}else console.log("Can't find parentID: "+a)}}}();